#!/bin/sh

echo "ðŸ” Running pre-commit checks..."

# Create a backup stash
STASH_NAME="pre-commit-$(date +%s)"
git stash push -k -u -m "$STASH_NAME" > /dev/null 2>&1
STASH_CREATED=$?

if [ $STASH_CREATED -eq 0 ]; then
    echo "âœ” Backed up original state in git stash ($STASH_NAME)"
fi

# Run lint-staged
npx lint-staged

# Check if lint-staged succeeded
if [ $? -eq 0 ]; then
    echo "âœ” Running tasks for staged files..."
    echo "âœ” Applying modifications from tasks..."
    echo "âœ” Cleaning up temporary files..."
    echo "âœ… Pre-commit checks passed!"
else
    echo "âŒ Pre-commit checks failed!"
    
    # Restore stash if it was created
    if [ $STASH_CREATED -eq 0 ]; then
        git stash pop > /dev/null 2>&1
        echo "ðŸ”„ Restored original state from stash"
    fi
    
    exit 1
fi
